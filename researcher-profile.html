<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Researcher Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./style.css" />

    <style>
      body {
        box-sizing: border-box;
      }
      .project-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .project-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }
      .tab-button.active {
        border-bottom: 3px solid #3b82f6;
        color: #3b82f6;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-full">
    <!-- Navigation -->
    <div id="navbar"></div>
    <script src="navbar.js"></script>
    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-6 py-8">
      <!-- Profile Header -->
      <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
        <div
          class="flex flex-col md:flex-row items-start md:items-center gap-8"
        >
          <!-- Profile Photo -->
          <div class="flex-shrink-0">
            <div
              id="profileAvatar"
              class="w-32 h-32 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white text-4xl font-bold"
            >
              SC
            </div>
          </div>

          <!-- Profile Info -->
          <div class="flex-1">
            <h1 id="profileName" class="text-3xl font-bold text-gray-900 mb-2">
              Loading...
            </h1>
            <p class="text-xl mb-3">
              <mark id="profileTitle" class="bg-yellow-500">Loading...</mark>
            </p>
            <p id="profileAffiliation" class="text-gray-600 mb-4">Loading...</p>

            <div id="researchAreas" class="flex flex-wrap gap-3 mb-4">
              <!-- Research areas will be populated dynamically -->
            </div>

            <div class="flex items-center gap-6 text-sm text-gray-600">
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                  <path
                    fill-rule="evenodd"
                    d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z"
                    clip-rule="evenodd"
                  />
                </svg>
                <span id="projectCount">0 Projects Funded</span>
              </div>
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span id="fundingAmount">$0 Raised</span>
              </div>
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    fill-rule="evenodd"
                    d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
                    clip-rule="evenodd"
                  />
                </svg>
                <span id="memberSince">Member since 2020</span>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex flex-col gap-3">
            <button
              class="asu text-white px-6 py-3 rounded-lg hover:bg-red-700 font-medium"
            >
              View All Researches
            </button>
            <a
              id="contactEmail"
              href="mailto:"
              class="border border-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-50 font-medium text-center"
            >
              Contact
            </a>
          </div>
        </div>
      </div>

      <!-- About Section -->
      <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">About</h2>
        <div id="profileBio" class="text-gray-700 leading-relaxed">
          <p>Loading...</p>
        </div>
      </div>

      <!-- Project Tabs -->
      <div class="bg-white rounded-xl shadow-sm mb-8">
        <div class="border-b border-gray-200">
          <nav class="flex space-x-8 px-8">
            <button
              class="tab-button active py-4 px-2 text-sm font-medium text-gray-500 hover:text-blue-600"
              onclick="showTab('current')"
            >
              Current Projects (3)
            </button>
            <button
              class="tab-button py-4 px-2 text-sm font-medium text-gray-500 hover:text-blue-600"
              onclick="showTab('upcoming')"
            >
              Upcoming Projects (2)
            </button>
            <button
              class="tab-button py-4 px-2 text-sm font-medium text-gray-500 hover:text-blue-600"
              onclick="showTab('completed')"
            >
              Completed Projects (8)
            </button>
          </nav>
        </div>

        <!-- Current Projects Tab -->
        <div id="current-tab" class="tab-content p-8">
          <div
            id="currentProjects"
            class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"
          >
            <!-- Projects will be loaded dynamically -->
          </div>
        </div>

        <!-- Upcoming Projects Tab -->
        <div id="upcoming-tab" class="tab-content p-8 hidden">
          <div id="upcomingProjects" class="grid md:grid-cols-2 gap-6">
            <!-- Upcoming projects will be loaded dynamically -->
          </div>
        </div>

        <!-- Completed Projects Tab -->
        <div id="completed-tab" class="tab-content p-8 hidden">
          <div
            id="completedProjects"
            class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"
          >
            <!-- Completed projects will be loaded dynamically -->
          </div>
        </div>
      </div>

      <!-- Publications & Recognition -->
      <div class="grid md:grid-cols-2 gap-8">
        <!-- Recent Publications -->
        <div class="bg-white rounded-xl shadow-sm p-8">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">
            Recent Publications
          </h2>
          <div class="space-y-4">
            <div class="border-l-4 border-blue-500 pl-4">
              <h3 class="font-semibold text-gray-900">
                Machine Learning Approaches to Drug Discovery
              </h3>
              <p class="text-sm text-gray-600">
                Nature Machine Intelligence • 2024
              </p>
            </div>
            <div class="border-l-4 border-green-500 pl-4">
              <h3 class="font-semibold text-gray-900">
                Genomic Biomarkers in Precision Medicine
              </h3>
              <p class="text-sm text-gray-600">Cell • 2023</p>
            </div>
            <div class="border-l-4 border-purple-500 pl-4">
              <h3 class="font-semibold text-gray-900">
                AI-Driven Protein Structure Prediction
              </h3>
              <p class="text-sm text-gray-600">Science • 2023</p>
            </div>
          </div>
        </div>

        <!-- Awards & Recognition -->
        <div class="bg-white rounded-xl shadow-sm p-8">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">
            Awards & Recognition
          </h2>
          <div class="space-y-4">
            <div class="flex items-center gap-3">
              <div
                class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center"
              >
                <svg
                  class="w-4 h-4 text-yellow-600"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                  />
                </svg>
              </div>
              <div>
                <h3 class="font-semibold text-gray-900">
                  NIH Early Career Investigator Award
                </h3>
                <p class="text-sm text-gray-600">2023</p>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <div
                class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"
              >
                <svg
                  class="w-4 h-4 text-blue-600"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                  />
                </svg>
              </div>
              <div>
                <h3 class="font-semibold text-gray-900">
                  Outstanding Research in Computational Biology
                </h3>
                <p class="text-sm text-gray-600">Stanford University • 2022</p>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <div
                class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"
              >
                <svg
                  class="w-4 h-4 text-green-600"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                  />
                </svg>
              </div>
              <div>
                <h3 class="font-semibold text-gray-900">
                  Top 40 Under 40 in Biotech
                </h3>
                <p class="text-sm text-gray-600">Nature Biotechnology • 2021</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      // Helper functions
      const getInitials = (name = "") =>
        name
          .split(" ")
          .filter(Boolean)
          .map((part) => part[0])
          .join("")
          .slice(0, 2)
          .toUpperCase() || "R";

      const getDepartmentColor = (department) => {
        const colors = {
          "Biomedical Engineering": "bg-red-100 text-red-800",
          Physics: "bg-yellow-100 text-yellow-800",
          Biochemistry: "bg-purple-100 text-purple-800",
          Engineering: "bg-orange-100 text-orange-800",
          "Computer Science": "bg-indigo-100 text-indigo-800",
          "Environmental Science": "bg-pink-100 text-pink-800",
          "Cell Biology": "bg-green-100 text-green-800",
          "Machine Learning": "bg-blue-100 text-blue-800",
          AI: "bg-red-100 text-red-800",
        };
        return colors[department] || "bg-gray-100 text-gray-800";
      };

      const formatCurrency = (amount) => {
        if (amount >= 1000000) {
          return `$${(amount / 1000000).toFixed(1)}M`;
        } else if (amount >= 1000) {
          return `$${(amount / 1000).toFixed(0)}K`;
        }
        return `$${amount}`;
      };

      // Get researcher ID from URL
      const urlParams = new URLSearchParams(window.location.search);
      const researcherId = parseInt(urlParams.get("id"));

      let researcherData = null;
      let allProjects = [];

      async function loadResearcherProfile() {
        if (!researcherId || isNaN(researcherId)) {
          document.body.innerHTML =
            '<div class="p-8 text-center"><h1 class="text-2xl font-bold mb-4">Invalid Researcher ID</h1><p class="text-gray-600">Please select a researcher from the <a href="./list-of-reseachers.html" class="text-blue-600 underline">researchers directory</a>.</p></div>';
          return;
        }

        try {
          const response = await fetch("./data.json");
          const data = await response.json();

          // Find the researcher
          researcherData = data.professors.find((p) => p.id === researcherId);

          if (!researcherData) {
            document.body.innerHTML =
              '<div class="p-8 text-center"><h1 class="text-2xl font-bold mb-4">Researcher Not Found</h1><p class="text-gray-600">The requested researcher profile could not be found.</p><a href="./list-of-reseachers.html" class="text-blue-600 underline mt-4 inline-block">Return to Researchers Directory</a></div>';
            return;
          }

          // Get all projects for this researcher
          allProjects = data.researchProjects.filter(
            (project) =>
              project.authorIds && project.authorIds.includes(researcherId)
          );

          // Update page title
          document.title = `${researcherData.name} - Researcher Profile`;

          // Update profile header
          const profileAvatar = document.getElementById("profileAvatar");
          profileAvatar.textContent = getInitials(researcherData.name);

          document.getElementById("profileName").textContent =
            researcherData.name;
          document.getElementById("profileTitle").textContent =
            researcherData.title || "Researcher";
          document.getElementById("profileAffiliation").textContent = `${
            researcherData.department || ""
          } | ${researcherData.affiliation || ""}`;

          // Update research areas
          const researchAreasDiv = document.getElementById("researchAreas");
          if (
            researcherData.researchAreas &&
            researcherData.researchAreas.length > 0
          ) {
            researchAreasDiv.innerHTML = researcherData.researchAreas
              .map(
                (area) =>
                  `<span class="px-3 py-1 rounded-full text-sm ${getDepartmentColor(
                    area
                  )}">${area}</span>`
              )
              .join("");
          }

          // Update stats
          document.getElementById(
            "projectCount"
          ).textContent = `${allProjects.length} Projects Funded`;

          const totalFunding = allProjects.reduce(
            (sum, p) => sum + (p.funding?.amount || 0),
            0
          );
          document.getElementById(
            "fundingAmount"
          ).textContent = `${formatCurrency(totalFunding)} Raised`;

          // Update bio
          const bioDiv = document.getElementById("profileBio");
          if (researcherData.bio) {
            bioDiv.innerHTML = `<p>${researcherData.bio}</p>`;
          }

          // Update contact email
          const contactLink = document.getElementById("contactEmail");
          if (researcherData.email && contactLink) {
            contactLink.href = `mailto:${researcherData.email}`;
          }

          // Render projects
          renderProjects();

          // Update tab counts
          updateTabCounts();
        } catch (error) {
          console.error("Failed to load researcher profile", error);
          document.body.innerHTML =
            '<div class="p-8 text-center"><h1 class="text-2xl font-bold mb-4">Error Loading Profile</h1><p class="text-gray-600">Unable to load the researcher profile at this time.</p></div>';
        }
      }

      function renderProjects() {
        // For now, all projects are considered "Active" since that's what's in the data
        // You can modify this logic based on your actual project statuses
        const currentProjects = allProjects.filter((p) => {
          const status = p.funding?.status?.toLowerCase();
          return status === "active" || !status;
        });
        const completedProjects = allProjects.filter((p) => {
          const status = p.funding?.status?.toLowerCase();
          return status === "completed" || status === "finished";
        });
        const upcomingProjects = allProjects.filter((p) => {
          const status = p.funding?.status?.toLowerCase();
          return status === "planning" || status === "upcoming";
        });

        renderProjectCards("currentProjects", currentProjects, "Active");
        renderProjectCards("completedProjects", completedProjects, "Completed");
        renderProjectCards("upcomingProjects", upcomingProjects, "Planning");
      }

      function renderProjectCards(containerId, projects, status) {
        const container = document.getElementById(containerId);
        if (!container) return;

        if (projects.length === 0) {
          container.innerHTML =
            '<p class="text-gray-500 col-span-full text-center py-8">No projects found.</p>';
          return;
        }

        container.innerHTML = projects
          .map((project) => {
            const funding = project.funding || {};
            const amount = funding.amount || 0;
            const percentage =
              amount > 0
                ? Math.min(100, Math.round((amount / (amount * 1.2)) * 100))
                : 0;

            let statusBadge = "";
            let statusColor = "";
            let progressBar = "";
            let button = "";

            if (status === "Active") {
              statusBadge =
                '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium">Active</span>';
              statusColor =
                percentage > 50
                  ? "bg-green-500"
                  : percentage > 25
                  ? "bg-blue-500"
                  : "bg-yellow-500";
              progressBar = `
              <div class="mb-4">
                <div class="flex justify-between text-sm text-gray-600 mb-1">
                  <span>${formatCurrency(amount)} raised</span>
                  <span>${formatCurrency(Math.round(amount * 1.2))} goal</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="${statusColor} h-2 rounded-full" style="width: ${percentage}%"></div>
                </div>
              </div>
            `;
              button =
                '<button class="w-full asu text-white py-2 rounded-lg hover:bg-red-700 text-sm font-medium">Support This Project</button>';
            } else if (status === "Completed") {
              statusBadge =
                '<span class="bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs font-medium">Completed</span>';
              const year = project.date
                ? new Date(project.date).getFullYear()
                : "N/A";
              progressBar = `<div class="text-sm text-green-600 mb-4"><span>✓ ${formatCurrency(
                amount
              )} raised</span></div>`;
              button =
                '<button class="w-full bg-yellow-500 text-black py-2 rounded-lg text-sm font-medium">View Results</button>';
            } else {
              statusBadge =
                '<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium">Planning</span>';
              progressBar = `<div class="text-sm text-gray-600 mb-4"><span>Target: ${formatCurrency(
                amount || 0
              )}</span></div>`;
              button =
                '<button class="w-full bg-gray-300 text-gray-600 py-2 rounded-lg text-sm font-medium cursor-not-allowed">Coming Soon</button>';
            }

            return `
            <div class="project-card bg-gray-50 rounded-lg p-6 border border-gray-200 flex flex-col justify-between">
              
              <div class="flex items-center justify-between mb-3">
                ${statusBadge}
                <span class="text-sm text-gray-500">${
                  status === "Completed" && project.date
                    ? new Date(project.date).getFullYear()
                    : percentage + "% Funded"
                }</span>
              </div>
              <h3 class="font-bold text-lg text-gray-900 mb-2">${
                project.title || "Untitled Project"
              }</h3>
              <p class="text-gray-600 text-sm mb-4">${
                project.description || ""
              }</p>

              <div class="mt-auto pt-0 space-y-4 float-">

                ${progressBar}
                ${button}
              </div>

              
            </div>
          `;
          })
          .join("");
      }

      function updateTabCounts() {
        const currentCount = allProjects.filter((p) => {
          const status = p.funding?.status?.toLowerCase();
          return status === "active" || !status;
        }).length;
        const upcomingCount = allProjects.filter((p) => {
          const status = p.funding?.status?.toLowerCase();
          return status === "planning" || status === "upcoming";
        }).length;
        const completedCount = allProjects.filter((p) => {
          const status = p.funding?.status?.toLowerCase();
          return status === "completed" || status === "finished";
        }).length;

        const tabs = document.querySelectorAll(".tab-button");
        tabs.forEach((tab) => {
          const text = tab.textContent;
          if (text.includes("Current")) {
            tab.textContent = `Current Projects (${currentCount})`;
          } else if (text.includes("Upcoming")) {
            tab.textContent = `Upcoming Projects (${upcomingCount})`;
          } else if (text.includes("Completed")) {
            tab.textContent = `Completed Projects (${completedCount})`;
          }
        });
      }

      function showTab(tabName) {
        // Hide all tab contents
        const tabContents = document.querySelectorAll(".tab-content");
        tabContents.forEach((content) => content.classList.add("hidden"));

        // Remove active class from all tab buttons
        const tabButtons = document.querySelectorAll(".tab-button");
        tabButtons.forEach((button) => button.classList.remove("active"));

        // Show selected tab content
        document.getElementById(tabName + "-tab").classList.remove("hidden");

        // Add active class to clicked button
        event.target.classList.add("active");
      }

      // Load profile when page loads
      document.addEventListener("DOMContentLoaded", loadResearcherProfile);
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'98b2bdefb424598b',t:'MTc1OTg5NjEzOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
